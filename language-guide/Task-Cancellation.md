---
description: ë¹„ë™ê¸° ì‘ì—…ì„ ì•ˆì „í•˜ê²Œ ì¢…ë£Œí•˜ëŠ” ë°©ë²•
---

ì‘ì—… ì·¨ì†Œ(Cancellation)ëŠ” ì‚¬ìš©ì ê²½í—˜(UX) í–¥ìƒì‹œí‚¤ê³ , ì‹œìŠ¤í…œ ìì›ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ê¼­ í•„ìš”í•œ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. 

ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ì§„ ì•±ì—ì„œ ì‚¬ìš©ìê°€ ì‚¬ì§„ ëª©ë¡ì„ ìŠ¤í¬ë¡¤í•˜ê³  ìˆë‹¤ê³  ê°€ì •í•´ë´…ì‹œë‹¤. ì‚¬ìš©ìê°€ ìŠ¤í¬ë¡¤í•  ë•Œ, í˜¸ë©´ì— ë³´ì´ëŠ” ì…€ì— í•´ë‹¹í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ë¶ˆëŸ¬ì˜¤ê²Œ ë©ë‹ˆë‹¤. ê·¸ëŸ°ë° ì‚¬ìš©ìê°€ ë¹ ë¥´ê²Œ ìŠ¤í¬ë¡¤í•˜ì—¬ í•´ë‹¹ ì…€ì´ í™”ë©´ì—ì„œ ì‚¬ë¼ì§€ë©´, ì•„ì§ ë¡œë”© ì¤‘ì¸ ì´ë¯¸ì§€ ì‘ì—…ì€ ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•Šê²Œ ë©ë‹ˆë‹¤. ì´ì²˜ëŸ¼ ë” ì´ìƒ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ì§€ ì•ŠëŠ” ì…€ì˜ ì´ë¯¸ì§€ë¥¼ ê³„ì†í•´ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì€ ë¹„íš¨ìœ¨ì ì´ë©°, ì‹œìŠ¤í…œ ìì›ì„ ë¶ˆí•„ìš”í•˜ê²Œ ë‚­ë¹„í•˜ê²Œ ë©ë‹ˆë‹¤.

Swift Concurrencyê°€ ë„ì…ë˜ê¸° ì „ê¹Œì§€ëŠ” ì´ëŸ¬í•œ ë¹„ë™ê¸° ì‘ì—…ì„ ì•ˆì „í•˜ê³  êµ¬ì¡°ì ìœ¼ë¡œ ì·¨ì†Œí•˜ëŠ” ê²ƒì´ ì‰½ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `DispatchQueue`ë¥¼ ì‚¬ìš©í•  ê²½ìš°, `DispatchWorkItem`ì„ ìƒì„±í•œ ë’¤ `cancel()`ì„ í˜¸ì¶œí•¨ìœ¼ë¡œì¨ ì‘ì—…ì„ ì·¨ì†Œí•  ìˆ˜ëŠ” ìˆì—ˆì§€ë§Œ, ì·¨ì†Œ ìƒíƒœë¥¼ ì‘ì—… ë‚´ë¶€ì— íš¨ê³¼ì ìœ¼ë¡œ ì „íŒŒí•˜ê¸° ì–´ë µê³ , ì¤‘ì²©ëœ ì‘ì—…ì´ë‚˜ ë¹„ë™ê¸° ì²´ì¸ì„ ê´€ë¦¬í•˜ê¸°ë„ ê¹Œë‹¤ë¡œì› ìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ í•œê³„ë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ `OperationQueue`ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë„ ìˆì—ˆì§€ë§Œ, êµ¬í˜„ì´ ë³µì¡í•´ì§€ê³  ì½”ë“œê°€ ì¥í™©í•´ì§„ë‹¤ëŠ” ë‹¨ì ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

```swift
let queue = DispatchQueue.global()

var innerTask: DispatchWorkItem?
let outerTask = DispatchWorkItem {
    let task = DispatchWorkItem {
        for j in 0...10 {
            if let innerTask = innerTask, innerTask.isCancelled {
                print("ğŸŸ  ë‚´ë¶€ ì‘ì—…ì´ ì·¨ì†Œë¨")
                break
            }
            sleep(1)
            print("âœ¨ ë‚´ë¶€ ì‘ì—… ìˆ˜í–‰ ì™„ë£Œ: \(j)")
        }
    }
    innerTask = task
    queue.async(execute: task)
    
    for i in 0...10 {
        if outerTask.isCancelled {
            innerTask?.cancel()
            print("ğŸŸ  ì™¸ë¶€ ì‘ì—…ì´ ì·¨ì†Œë¨")
            break
        }
        sleep(1)
        print("â¡ï¸ ì™¸ë¶€ ì‘ì—… ìˆ˜í–‰ ì™„ë£Œ: \(i)")
    }
}

queue.async(execute: outerTask)

queue.asyncAfter(deadline: .now() + 3) {
    outerTask.cancel()
}
```

ìœ„ ì˜ˆì œëŠ” `Grand Central Dispatch(GCD)`ë¥¼. ì´ìš©í•œ ë¹„ë™ê¸° ì²˜ë¦¬ì—ì„œ ì™¸ë¶€ ì‘ì—…ì´ ì·¨ì†Œë  ê²½ìš°, í•´ë‹¹ ì·¨ì†Œ ì‹ í˜¸ë¥¼ ë‚´ë¶€ ì‘ì—…ì— ëª…ì‹œì ìœ¼ë¡œ ì „íŒŒí•´ì•¼ í•¨ì„ ë³´ì—¬ì¤ë‹ˆë‹¤. `DispatchWorkItem`ì€ ë‚´ë¶€ ì‘ì—…ì— ëŒ€í•œ ì·¨ì†Œ ì „íŒŒë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì£¼ì§€ ì•Šê¸° ë•Œë¬¸ì—, ì™¸ë¶€ ì‘ì—…ì´ ì·¨ì†Œë  ë•Œ ë‚´ë¶€ ì‘ì—…ë„ í•¨ê»˜ ì·¨ì†Œë˜ê¸¸ ì›í•œë‹¤ë©´ ì´ë¥¼ ì§ì ‘ ì½”ë“œë¡œ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë°©ì‹ì€ ë³µì¡í•  ë¿ ì•„ë‹ˆë¼, ì‘ì—… ì·¨ì†Œë¥¼ ì œëŒ€ë¡œ ì²˜ë¦¬í•˜ì§€ ëª»í•´ ì‹¤ìˆ˜ê°€ ë°œìƒí•˜ê¸° ì‰¬ìš´ ìœ„í—˜í•œ ì½”ë“œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Swift ConcurrencyëŠ” ë³´ë‹¤ êµ¬ì¡°í™”ë˜ê³  ì´í•´í•˜ê¸° ì‰¬ìš´ ë°©ì‹ìœ¼ë¡œ ì‘ì—… ì·¨ì†Œë¥¼ ì§€ì›í•©ë‹ˆë‹¤. êµ¬ì¡°í™”ëœ ë™ì‹œì„±(Strucutred Concurrency)ì—ì„œëŠ” ëª¨ë“  ì‘ì—…ì´ ì‘ì—… íŠ¸ë¦¬(Task Tree) êµ¬ì¡°ë¡œ êµ¬ì„±ë˜ë©°, ìƒìœ„ ì‘ì—…ì—ì„œ ë°œìƒí•œ ì·¨ì†Œ ì‹ í˜¸ëŠ” ìë™ìœ¼ë¡œ ëª¨ë“  í•˜ìœ„ ì‘ì—…ì— ì „íŒŒë©ë‹ˆë‹¤. í•˜ìœ„ ì‘ì—…ë“¤ì€ ìì‹ ë“¤ì˜ ì‘ì—… ì»¨í…ìŠ¤íŠ¸ë¥¼ ìŠ¤ìŠ¤ë¡œ ì •ë¦¬í•œ ë’¤ ìƒìœ„ ì‘ì—…ì—ê²Œ ì¢…ë£Œë¥¼ ì•Œë¦¬ê³ , ëª¨ë“  í•˜ìœ„ ì‘ì—…ì´ ì™„ë£Œë˜ë©´ ìƒìœ„ ì‘ì—…ë„ ì¢…ë£Œë©ë‹ˆë‹¤.

Swift ConcurrencyëŠ” í˜‘ë ¥ì  ì·¨ì†Œ(Cooperative Cancellation) ëª¨ë¸ì„ ë”°ë¦…ë‹ˆë‹¤. ì´ëŠ” ê° ì‘ì—…ì´ ì‹¤í–‰ ë„ì¤‘ ìŠ¤ìŠ¤ë¡œ ì·¨ì†Œ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³ , ê·¸ì— ë§ëŠ” ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•´ì•¼ í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ìƒìœ„ ì‘ì—…ì´ í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì‹ í˜¸ë¥¼ ì „íŒŒí•˜ë”ë¼ë„, í•˜ìœ„ ì‘ì—…ì´ ì¦‰ì‹œ ì¢…ë£Œë˜ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. ë‹¨ì§€ `Task.isCancelled` í”„ë¡œí¼í‹°ì˜ ê°’ì´ `true`ë¡œ ì„¤ì •ë  ë¿ì´ë©°, ì‹¤ì œ ì¢…ë£Œ ì—¬ë¶€ëŠ” í•˜ìœ„ ì‘ì—…ì˜ êµ¬í˜„ ë°©ì‹ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì–´ë–¤ ì‘ì—…ì€ ì·¨ì†Œ ì‹œ ì¤‘ê°„ ê²°ê³¼ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆê³ , ë˜ ì–´ë–¤ ì‘ì—…ì€ `CancellationError`ë¥¼ ë˜ì§€ë©° ì¦‰ì‹œ ì¢…ë£Œë˜ê¸°ë„ í•©ë‹ˆë‹¤. ì´ì²˜ëŸ¼ ì‘ì—…ë§ˆë‹¤ ì·¨ì†Œì— ëŒ€í•œ ë°˜ì‘ì´ ë‹¤ë¥¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ì‘ì—…ì„ ì„¤ê³„í•  ë•ŒëŠ” í•­ìƒ ì·¨ì†Œ ê°€ëŠ¥ì„±ì„ ê³ ë ¤í•˜ì—¬ ì„¤ê³„í•´ì•¼ í•©ë‹ˆë‹¤.

ì‘ì—…ì„ ì·¨ì†Œí•˜ë ¤ë©´ `Task` ì¸ìŠ¤í„´ìŠ¤ì˜ `cancel()` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ `Task` ë‚´ì˜ í˜¸ì¶œëœ ë¹„ë™ê¸° í•¨ìˆ˜(Asynchronous), `async-let` ë°”ì¸ë”© í˜¹ì€ ì‘ì—… ê·¸ë£¹ì— ì·¨ì†Œ ì‹ í˜¸ê°€ ì „íŒŒë©ë‹ˆë‹¤.

ì‘ì—…ì˜ ì·¨ì†Œ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

* `[Task.checkCancellation()]()`: ì‘ì—… ì·¨ì†Œ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³ , ì·¨ì†Œë˜ì—ˆì„ ê²½ìš° `CancellationError`ë¥¼ ë˜ì§€ë©° ì¦‰ì‹œ ì‹¤í–‰ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.

* `[Task.isCancelled]()`: ì‘ì—… ì·¨ì†Œ ì—¬ë¶€ë¥¼ `Bool` ê°’ìœ¼ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤. ê°œë°œìê°€ ì§ì ‘ ì¤‘ë‹¨ ì¡°ê±´ì„ ì •ì˜í•  ìˆ˜ ìˆìœ¼ë©°, ë„¤íŠ¸ì›Œí¬ ì—°ê²° í•´ì œ, ì„ì‹œ íŒŒì¼ ì‚­ì œ ë“± ìì› ì»¨í…ìŠ¤íŠ¸ ì •ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


```swift
func downloadImage() async throws -> UIImage {
    try await Task.checkCancellation()
    // ...
    return image
}
```



# Task Cancellation in Structured Concurrency

êµ¬ì¡°í™”ëœ ë™ì‹œì„±ì—ì„œëŠ” ëª¨ë“  ì‘ì—…ì´ ì‘ì—… íŠ¸ë¦¬(Task Tree) êµ¬ì¡°ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ì´ êµ¬ì¡°ì—ì„œëŠ” ìƒìœ„ ì‘ì—…ì—ì„œ ì·¨ì†Œ ì‹ í˜¸ê°€ ë°œìƒí•˜ë©´, í•´ë‹¹ ì‹ í˜¸ê°€ ëª¨ë“  í•˜ìœ„ ì‘ì—…ì— ìë™ìœ¼ë¡œ ì „íŒŒë©ë‹ˆë‹¤. í•˜ìœ„ ì‘ì—…ë“¤ì€ ìì‹ ì˜ ì‘ì—… ì»¨í…ìŠ¤íŠ¸ë¥¼ ìŠ¤ìŠ¤ë¡œ ì •ë¦¬í•œ ë’¤, ìƒìœ„ ì‘ì—…ì—ê²Œ ì¢…ë£Œë¥¼ ì•Œë¦½ë‹ˆë‹¤. ëª¨ë“  í•˜ìœ„ ì‘ì—…ì´ ì¢…ë£Œë˜ë©´, ìƒìœ„ ì‘ì—…ë„ ë’¤ì´ì–´ í•¨ê»˜ ì¢…ë£Œë©ë‹ˆë‹¤.

êµ¬ì¡°í™”ëœ ë™ì‹œì„±ì—ì„œì˜ ì·¨ì†Œ ì „íŒŒëŠ” ë‹¤ìŒ ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* **ì•”ì‹œì (Implicit) ì·¨ì†Œ ì „íŒŒ:** ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ì·¨ì†Œ ì‹ í˜¸ë¥¼ ì „íŒŒí•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í•˜ìœ„ ì‘ì—… ì¤‘ í•˜ë‚˜ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´, ê·¸ ì‹œì ë¶€í„° ëª¨ë“  ë‹¤ë¥¸ í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì‹ í˜¸ê°€ ìë™ìœ¼ë¡œ ì „íŒŒë©ë‹ˆë‹¤.

* **ëª…ì‹œì (explicit) ì·¨ì†Œ ì „íŒŒ:** ì§ì ‘ `Task.cancel()`ì´ë‚˜ `cancelAll()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ ì·¨ì†Œ ì‹ í˜¸ë¥¼ ì „íŒŒí•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. 



## Implicit Cancellation Propagation

ì•”ì‹œì  ì·¨ì†Œ ì „íŒŒëŠ” ë³‘ë ¬ë¡œ ìˆ˜í–‰ ì¤‘ì¸ í•˜ìœ„ ì‘ì—… ì¤‘ í•˜ë‚˜ê°€ ì˜ˆì™¸ë¥¼ ë˜ì¡Œì„ ë•Œ ë°œìƒí•©ë‹ˆë‹¤. í•˜ìœ„ ì‘ì—…ì´ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¤ë©´, ì´ë¥¼ ìˆ˜ì‹ í•œ ìƒìœ„ ì‘ì—…ì€ ì¦‰ì‹œ ë‚˜ë¨¸ì§€ ì‹¤í–‰ ì¤‘ì¸ ëª¨ë“  í•˜ìœ„ ì‘ì—…ì—ê²Œ ì·¨ì†Œ ì‹ í˜¸ë¥¼ ì „íŒŒí•©ë‹ˆë‹¤. 

```
ğŸ“¦ withThrowingTaskGroup { .. }   â† 2ï¸âƒ£ í•˜ìœ„ ì‘ì—…ì´ ë˜ì§„ ì˜ˆì™¸ ë°›ìŒ
 â”œâ”€â”€ ğŸ§µ downloadImage(from: url)  â† 3ï¸âƒ£ (ì‹¤í–‰ ì¤‘ì¸) í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì „íŒŒ
 â”œâ”€â”€ ğŸ§µ downloadImage(from: url)  â† 3ï¸âƒ£ (ì‹¤í–‰ ì¤‘ì¸) í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì „íŒŒ
 â””â”€â”€ ğŸ§µ downloadImage(from: url)  â† 1ï¸âƒ£ ì˜ˆì™¸ ë°œìƒ ë° ìƒìœ„ ì‘ì—…ìœ¼ë¡œ throw
```

ì•„ë˜ ì˜ˆì œëŠ” `TaskGroup`ì„ ì‚¬ìš©í•´ ì—¬ëŸ¬ ì´ë¯¸ì§€ë¥¼ ë³‘ë ¬ë¡œ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ê³¼ì •ì—ì„œ, ì¼ë¶€ í•˜ìœ„ ì‘ì—…ì´ ì˜ˆì™¸ë¥¼ ë˜ì§€ë©´ ë‚˜ë¨¸ì§€ í•˜ìœ„ ì‘ì—…ë“¤ì— ì•”ì‹œì ìœ¼ë¡œ ì·¨ì†Œê°€ ì „íŒŒëœë‹¤ëŠ” ì ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

```swift
func downloadImages(from urls: [String]) async throws -> [UIImage] {
    try await withThrowingTaskGroup(of: UIImage?.self) { group in
        group.addTask {   // 3ï¸âƒ£ (ì‹¤í–‰ ì¤‘ì¸) í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì „íŒŒ
            guard !Task.isCancelled else { 
                print("ğŸŸ  ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì·¨ì†Œ - 1")
                return nil 
            }
            return try await downloadImage(from: urls[0])
        }
        group.addTask {   // 3ï¸âƒ£ (ì‹¤í–‰ ì¤‘ì¸) í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì „íŒŒ
            guard !Task.isCancelled else { 
                print("ğŸŸ  ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì·¨ì†Œ - 2")
                return nil 
            }
            return try await downloadImage(from: urls[0])
        }
        group.addTask {   // 3ï¸âƒ£ (ì‹¤í–‰ ì¤‘ì¸) í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì „íŒŒ
            guard !Task.isCancelled else { 
                print("ğŸŸ  ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì·¨ì†Œ - 3")
                return nil 
            }
            return try await downloadImage(from: urls[0])
        }
        group.addTask {   // 3ï¸âƒ£ (ì‹¤í–‰ ì¤‘ì¸) í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì „íŒŒ
            try? await Task.sleep(for: .seconds(5))
            guard !Task.isCancelled else { 
                print("ğŸŸ  ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì·¨ì†Œ - 4")
                return nil 
            }
            return try await downloadImage(from: urls[0])
        }
        group.addTask {   // 3ï¸âƒ£ (ì‹¤í–‰ ì¤‘ì¸) í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì „íŒŒ
            try? await Task.sleep(for: .seconds(10))
            guard !Task.isCancelled else { 
                print("ğŸŸ  ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì·¨ì†Œ - 5")
                return nil 
            }
            return try await downloadImage(from: urls[0])
        }
        group.addTask {   // 1ï¸âƒ£ ì˜ˆì™¸ ë°œìƒ ë° ìƒìœ„ ì‘ì—…ìœ¼ë¡œ throw
            try await Task.sleep(for: .seconds(5))
            throw CancellationError() 
        }
        
        var images: [UIImage] = []
        for try await image in group {   // 2ï¸âƒ£ í•˜ìœ„ ì‘ì—…ì´ ë˜ì§„ ì˜ˆì™¸ ë°›ìŒ
            if let image = image {
                images.append(image)
            }
        }
        return images   // 4ï¸âƒ£ ì˜ˆì™¸ë¥¼ `downloadImages(from:)` í•¨ìˆ˜ ë°–ìœ¼ë¡œ ë˜ì§
    }
}
Task {
    do {
        try await downloadImages(from: urls)
    } catch {
        print("ğŸ’¥ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì·¨ì†Œ")
    }
}

// Prints "ğŸŸ  ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì·¨ì†Œ - 5"
// Prints "ğŸŸ  ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì·¨ì†Œ - 4"
// Prints "ğŸ’¥ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì·¨ì†Œ"
```

ì‘ì—… ê·¸ë£¹ì— 5ì´ˆ í›„ ì·¨ì†Œ ì˜ˆì™¸ë¥¼ ë˜ì§€ëŠ” í•˜ìœ„ ì‘ì—…ì„ ì¶”ê°€í•¨ìœ¼ë¡œì¨, ì•”ì‹œì  ì·¨ì†Œ ì „íŒŒê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. 1~3ë²ˆì§¸ í•˜ìœ„ ì‘ì—…ì€ ì¦‰ì‹œ ì‹¤í–‰ë˜ì–´ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³ , ê·¸ ê²°ê³¼ë¥¼ `images` ë°°ì—´ì— ì¶”ê°€í•©ë‹ˆë‹¤. 4ë²ˆì§¸ì™€ 5ë²ˆì§¸ í•˜ìœ„ ì‘ì—…ì€ ê°ê° 5ì´ˆ, 10ì´ˆ ë’¤ì— ì‹¤í–‰í•˜ë„ë¡ ì ì‹œ ëŒ€ê¸°í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ 6ë²ˆì§¸ë¡œ ì¶”ê°€ëœ í•˜ìœ„ ì‘ì—…ì´ 5ì´ˆ ë’¤ `CancellationError` ì˜ˆì™¸ë¥¼ ë˜ì§€ê³ , ì´ë¥¼ ê°ì§€í•œ ìƒìœ„ ì‘ì—…ì€ ì•„ì§ ì‹¤í–‰ ì¤‘ì´ê±°ë‚˜ ëŒ€ê¸° ì¤‘ì¸ 4ë²ˆì§¸ì™€ 5ë²ˆì§¸ í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì‹ í˜¸ë¥¼ ì „íŒŒí•©ë‹ˆë‹¤. ì´í›„ ëª¨ë“  í•˜ìœ„ ì‘ì—…ì´ ì •ë¦¬ë˜ë©´, `withThrowingTaskGroup`ì€ ë°œìƒí•œ ì˜ˆì™¸ë¥¼ `downloadImages(from:)` í•¨ìˆ˜ì˜ í˜¸ì¶œìì—ê²Œ ë˜ì§€ê³ , í•´ë‹¹ ì‘ì—…ì€ ì¢…ë£Œë©ë‹ˆë‹¤.

ì´ë•Œ, ì´ë¯¸ ë‹¤ìš´ë¡œë“œëœ ì´ë¯¸ì§€ë“¤ì´ `images` ë°°ì—´ì— ë‹´ê²¨ ìˆë”ë¼ë„, ì‘ì—… ì „ì²´ê°€ ì‹¤íŒ¨í–ˆê¸° ë•Œë¬¸ì— ë°˜í™˜ë˜ì§€ ì•Šê³  ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì½”ë“œë¥¼ ì•½ê°„ ìˆ˜ì •í•´, ì‘ì—… ì¤‘ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë”ë¼ë„ ì§€ê¸ˆê¹Œì§€ ì™„ë£Œëœ ê²°ê³¼ë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜ë˜ë„ë¡ ê°œì„ í•´ ë³´ê² ìŠµë‹ˆë‹¤. 

```swift
func downloadImages(from urls: [String]) async throws -> [UIImage] {
    try await withThrowingTaskGroup(of: UIImage?.self) { group in
        // ...
        group.addTask { 
            try? await Task.sleep(for: .seconds(5))
            guard !Task.isCancelled else { 
                print("ğŸŸ  ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì·¨ì†Œ - 4")
                return nil 
            }
            return try await downloadImage(from: urls[0])
        }
        group.addTask { 
            try? await Task.sleep(for: .seconds(10))
            guard !Task.isCancelled else { 
                print("ğŸŸ  ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì·¨ì†Œ - 5")
                return nil 
            }
            return try await downloadImage(from: urls[0])
        }
        group.addTask {
            try await Task.sleep(for: .seconds(5))
            throw CancellationError()
        }
        
        var images: [UIImage] = []
        do {
            for try await image in group {
                if let image = image {
                    images.append(image)
                }
            }
        } catch {
            print("âœ¨ í•˜ìœ„ ì‘ì—…ì—ì„œ ë˜ì§„ ì˜ˆì™¸ë¥¼ ê³§ë°”ë¡œ ì†Œë¹„í•¨") // ë‹¤ë¥¸ í•˜ìœ„ ì‘ì—…ìœ¼ë¡œ ì·¨ì†Œ ì „íŒŒ ì•ˆí•¨
            //group.cancelAll()
        }
        return images
    }
}
Task {
    try await downloadImages(from: urls)
    print("ğŸŒ± ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì™„ë£Œ")
}

// Prints "âœ¨ í•˜ìœ„ ì‘ì—…ì—ì„œ ë˜ì§„ ì˜ˆì™¸ë¥¼ ê³§ë°”ë¡œ ì†Œë¹„í•¨"
// Prints "ğŸŒ± ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì™„ë£Œ"
```

ìœ„ ì˜ˆì œì—ì„œ ì£¼ì˜ ê¹Šê²Œ ì‚´í´ë´ì•¼ í•  ì ì€ í•˜ìœ„ ì‘ì—…ì´ ì˜ˆì™¸ë¥¼ ë˜ì§€ë”ë¼ë„, ê³§ë°”ë¡œ ë‚˜ë¨¸ì§€ í•˜ìœ„ ì‘ì—…ë“¤ì— ì·¨ì†Œ ì‹ í˜¸ê°€ ì „íŒŒë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ëŠ” ì ì…ë‹ˆë‹¤. Swift Concurrencyì—ì„œ ì•”ì‹œì  ì·¨ì†Œ ì „íŒŒê°€ ì‘ë™í•˜ë ¤ë©´, ì˜ˆì™¸ê°€ í•˜ìœ„ ì‘ì—…ì—ì„œ ë˜ì ¸ì¡Œì„ ë¿ë§Œ ì•„ë‹ˆë¼, `withThrowingTaskGroup`ì´ í•´ë‹¹ ì˜ˆì™¸ë¥¼ ì‹¤ì œë¡œ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤. ì¦‰, ë‹¨ìˆœíˆ í•˜ìœ„ ì‘ì—…ì´ ì˜ˆì™¸ë¥¼ ë˜ì§€ëŠ” ê²ƒë§Œìœ¼ë¡œëŠ” ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ìœ„ ì˜ˆì œì—ì„œëŠ” í•˜ìœ„ ì‘ì—… ì¤‘ í•˜ë‚˜ê°€ `CancellationError`ë¥¼ ë˜ì§€ì§€ë§Œ, ìƒìœ„ ì‘ì—…ì´ `do-catch` êµ¬ë¬¸ìœ¼ë¡œ í•´ë‹¹ ì˜ˆì™¸ë¥¼ ì§ì ‘ ì²˜ë¦¬(ì†Œë¹„)í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ ê²½ìš° `withThrowingTaskGroup`ì€ ì˜ˆì™¸ë¥¼ ë°”ê¹¥ìœ¼ë¡œ ë˜ì§€ì§€ ì•Šê¸° ë•Œë¬¸ì—, ë‹¤ë¥¸ í•˜ìœ„ ì‘ì—…ë“¤ì— ì·¨ì†Œ ì‹ í˜¸ë¥¼ ì „íŒŒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ ê²°ê³¼, ì´ì „ ì˜ˆì œì—ì„œëŠ” 4ë²ˆì§¸ì™€ 5ë²ˆì§¸ í•˜ìœ„ ì‘ì—…ì´ ì·¨ì†Œë˜ë©° "ğŸŸ  ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì·¨ì†Œ" ë©”ì‹œì§€ê°€ ì¶œë ¥ë˜ì—ˆì§€ë§Œ, ì´ ì˜ˆì œì—ì„œëŠ” ê·¸ëŸ¬í•œ ë¡œê·¸ê°€ ì¶œë ¥ë˜ì§€ ì•ŠëŠ” ê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


{% hint style="Info" %}
**Note**
`URLSession`ì˜ `data(from:)` ë¹„ë™ê¸° ë©”ì„œë“œëŠ” ì‘ì—… ì‹¤í–‰ ì¤‘ ì·¨ì†Œ ì‹ í˜¸ë¥¼ ë°›ìœ¼ë©´, ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ìë™ìœ¼ë¡œ ì¤‘ë‹¨í•˜ê³  `URLError.cancelled` ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.
{% endhint %}



## Explicit Cancellation Propagation

ëª…ì‹œì  ì·¨ì†Œ ì „íŒŒëŠ” `Task`ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ `cancel()` í•¨ìˆ˜ë‚˜, ì‘ì—… ê·¸ë£¹ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ `cancelAll()` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ ë°œìƒí•©ë‹ˆë‹¤. ì´ í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë©´ ì§€ì²´ì—†ì´ ëª¨ë“  í•˜ìœ„ì‘ì—…ë“¤ì— ì·¨ì†Œ ì‹ í˜¸ë¥¼ ì „íŒŒí•©ë‹ˆë‹¤.

```
downloadImages()  â† 1ï¸âƒ£ ì·¨ì†Œ ì‹ í˜¸ ë°œìƒ ë° í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì „íŒŒ
 â”œâ”€â”€ ğŸ§µ downloadImage(from: url)  â† 2ï¸âƒ£ ì·¨ì†Œ ì‹ í˜¸ ìˆ˜ì‹  ë° ì‘ì—… ì •ë¦¬
 â”œâ”€â”€ ğŸ§µ downloadImage(from: url)  â† 2ï¸âƒ£ ì·¨ì†Œ ì‹ í˜¸ ìˆ˜ì‹  ë° ì‘ì—… ì •ë¦¬
 â””â”€â”€ ğŸ§µ downloadImage(from: url)  â† 2ï¸âƒ£ ì·¨ì†Œ ì‹ í˜¸ ìˆ˜ì‹  ë° ì‘ì—… ì •ë¦¬ 
```

ì•„ë˜ ì˜ˆì œëŠ” `async-let` ë°”ì¸ë”©ìœ¼ë¡œ ì„¸ ê°œì˜ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë‹¤ê°€, 1ì´ˆ í›„ ì‘ì—… ì·¨ì†Œê°€ ì¼ì–´ë‚˜ë©´ í•˜ìœ„ ì‘ì—…ë“¤ì— ì·¨ì†Œê°€ ì „íŒŒëœë‹¤ëŠ” ì ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

```swift
func downloadImages(from urls: [String]) async throws -> [UIImage?] {
    async let firstImage = downloadImage(from: urls[0])
    async let secondImage = downloadImage(from: urls[0])
    async let thirdImage = downloadImage(from: urls[0])
    
    return try await [firstImage, secondImage, thirdImage] // 2ï¸âƒ£ ì·¨ì†Œ ì‹ í˜¸ ìˆ˜ì‹  ë° ì‘ì—… ì •ë¦¬
}
Task {
    let imageTask = Task { 
        do {
            try await downloadImages(from: urls)
        } catch {
            print("ğŸ’¥ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì·¨ì†Œ")
        }
    }
//    try? await Task.sleep(for: .seconds(1))
    imageTask.cancel()  // 1ï¸âƒ£ ì·¨ì†Œ ì‹ í˜¸ ë°œìƒ ë° í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì „íŒŒ
}

// Prints "ğŸ’¥ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì‘ì—… ì·¨ì†Œ"
```

ì‘ì—…ê·¸ë£¹ì˜ `cancelAll()`ì„ í˜¸ì¶œí•˜ì—¬ ë¹„ìŠ·í•œ ë°©ì‹ìœ¼ë¡œ í•˜ìœ„ ì‘ì—…ë“¤ì— ì·¨ì†Œ ì‹ í˜¸ë¥¼ ì „íŒŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
func downloadImages() async throws -> [UIImage] {
    try await withThrowingTaskGroup(of: UIImage?.self) { group in  // 2ï¸âƒ£ ì·¨ì†Œ ì‹ í˜¸ ìˆ˜ì‹  ë° ì‘ì—… ì •ë¦¬
        let random = Int.random(in: 1..<10)
        for _ in 0..<1_000 {
            group.addTask {  // 2ï¸âƒ£ ì·¨ì†Œ ì‹ í˜¸ ìˆ˜ì‹  ë° ì‘ì—… ì •ë¦¬
                return try await downloadImage(from: url) 
            }
        }
        
        var images: [UIImage] = []
        
        
        for try await image in group {
            if let image = image {
                images.append(image)
            }
            if images.count == random {
                group.cancelAll()  // 1ï¸âƒ£ ì·¨ì†Œ ì‹ í˜¸ ë°œìƒ ë° í•˜ìœ„ ì‘ì—…ì— ì·¨ì†Œ ì „íŒŒ
                break
            }
        }
        return images
    }
}
Task { try? await downloadImages() }

```

ìœ„ ì˜ˆì œëŠ” íŠ¹ì • ê°œìˆ˜(ì„ì˜ì˜ ì •ìˆ˜ê°’)ê°€ ë‹¤ìš´ë¡œë“œë˜ë©´, `cancelAll()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ë‚˜ë¨¸ì§€ í•˜ìœ„ ì‘ì—…ë“¤ì„ ëª…ì‹œì ìœ¼ë¡œ ì·¨ì†Œí•©ë‹ˆë‹¤. ì´ë•Œ ì‘ì—…ê·¸ë£¹ì˜ ëŒ€ê¸° ì¤‘ì´ê±°ë‚˜ ì‹¤í–‰ ì¤‘ì¸ í•˜ìœ„ ì‘ì—…ë“¤ì— ì¦‰ì‹œ ì·¨ì†Œ ì‹ í˜¸ë¥¼ ì „íŒŒí•˜ê³ , í•˜ìœ„ ì‘ì—…ë“¤ì€ ê³§ë°”ë¡œ ì‘ì—…ì„ ì¢…ë£Œí•˜ê²Œ ë©ë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ, ì·¨ì†Œ ì‹œì ê¹Œì§€ ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œëœ íŠ¹ì • ê°œìˆ˜ì˜ ì´ë¯¸ì§€ë“¤ë§Œ `images` ë°°ì—´ì— ë‹´ê²¨ ë°˜í™˜ë©ë‹ˆë‹¤.



# Cancellation Propagation in Unstructured Concurrency

êµ¬ì¡°í™”ë˜ì§€ ì•Šì€ ë™ì‹œì„±(Unstructured Concurrency)ëŠ” ì·¨ì†Œ ì „íŒŒê°€ ì¤‘ì²©ëœ ë‚´ë¶€ `Task`ë‚˜ `Detached Task`ì—ëŠ” ìë™ìœ¼ë¡œ ì·¨ì†Œ ì „íŒŒê°€ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ êµ¬ì¡°ì—ì„œëŠ” ê° `Task`ì— ìˆ˜ë™ìœ¼ë¡œ ì·¨ì†Œë¥¼ ì „íŒŒí•´ì•¼ í•©ë‹ˆë‹¤.

```swift
let outerTask = Task {
    try? await Task.sleep(for: .seconds(1))
    
    if Task.isCancelled {
        print("ğŸŸ¡ outerTask ì‘ì—… ì·¨ì†Œ")
    }
    
    let innerTask = Task {
        if Task.isCancelled {
            print("ğŸŸ¡ innerTask ì‘ì—… ì·¨ì†Œ")
            return
        }
        
        print("â¡ï¸ Task2 ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
    }
}
outerTask.cancel()

// Prints "ğŸŸ¡ outerTask ì‘ì—… ì·¨ì†Œ"
// Prints "â¡ï¸ Task2 ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
```

